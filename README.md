# RAG ç³»ç»Ÿ Benchmark è¯„æµ‹æ¡†æ¶

<div align="center">

**åŸºäº LLM-Driven çš„ RAG ç³»ç»Ÿè‡ªåŠ¨åŒ–è¯„æµ‹åŸºå‡†**

[![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)](https://www.python.org/)
[![Hugging Face](https://img.shields.io/badge/ğŸ¤—-Datasets-yellow.svg)](https://huggingface.co/HEHUA2005)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)

</div>

---

## ğŸ“– é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®æ˜¯ä¸Šæµ·äº¤é€šå¤§å­¦ã€Šè‡ªç„¶è¯­è¨€å¤„ç†ã€‹è¯¾ç¨‹å¤§ä½œä¸š2çš„é…å¥— **Benchmark è¯„æµ‹æ¡†æ¶**ï¼Œä¸º RAGï¼ˆRetrieval-Augmented Generationï¼‰æ™ºèƒ½è¯¾ç¨‹åŠ©æ•™ç³»ç»Ÿæä¾›æ ‡å‡†åŒ–çš„è¯„æµ‹ä½“ç³»ã€‚

### æ ¸å¿ƒç‰¹æ€§

- **ğŸ¯ LLM-Driven æ•°æ®ç”Ÿæˆ**ï¼šåŸºäº PDF è¯¾ç¨‹æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆé«˜è´¨é‡ QA æ•°æ®é›†
- **ğŸ“Š å¤šç»´åº¦è¯„åˆ†ä½“ç³»**ï¼šæ¥æºå‡†ç¡®æ€§ï¼ˆ60%ï¼‰+ å†…å®¹å‡†ç¡®æ€§ï¼ˆ20%ï¼‰+ å®Œæ•´æ€§ï¼ˆ15%ï¼‰+ ç›¸å…³æ€§ï¼ˆ5%ï¼‰
- **ğŸš€ è‡ªåŠ¨åŒ–è¯„æµ‹æµç¨‹**ï¼šä»æ•°æ®ä¸‹è½½åˆ°ç»“æœå¯è§†åŒ–çš„å®Œæ•´ Pipeline
- **ğŸ“ˆ ä¸°å¯Œçš„å¯è§†åŒ–**ï¼š6 ç§å›¾è¡¨ç±»å‹å…¨æ–¹ä½å±•ç¤ºè¯„æµ‹ç»“æœ
- **â˜ï¸ Hugging Face é›†æˆ**ï¼šæ•°æ®é›†æ‰˜ç®¡åœ¨ Hugging Face Hubï¼Œå¼€ç®±å³ç”¨
- **âš¡ å¹¶è¡Œå¤„ç†**ï¼šæ”¯æŒå¤šçº¿ç¨‹å¹¶è¡Œè¯„æµ‹ï¼Œæå‡æ•ˆç‡

### æ•°æ®é›†ä»‹ç»

æœ¬ Benchmark åŒ…å« 5 é—¨æ€æ”¿è¯¾ç¨‹çš„ QA æ•°æ®é›†ï¼š

| è¯¾ç¨‹åç§° | Split åç§° | é—®é¢˜æ•°é‡ |
|---------|-----------|---------|
| æ¯›æ³½ä¸œæ€æƒ³æ¦‚è®º | `Mao_Zedong_Thought` | ~100 |
| é©¬å…‹æ€ä¸»ä¹‰åŸºæœ¬åŸç† | `Principles_of_Marxism` | ~100 |
| ä¸­å›½è¿‘ç°ä»£å²çº²è¦ | `Outline_of_Modern_and_Contemporary_Chinese_History` | ~100 |
| æ€æƒ³é“å¾·ä¸æ³•æ²» | `Ideological_Morality_and_Legal_System` | ~100 |
| ä¹ è¿‘å¹³æ–°æ—¶ä»£ä¸­å›½ç‰¹è‰²ç¤¾ä¼šä¸»ä¹‰æ€æƒ³æ¦‚è®º | `An_Introduction_to_Xi_Jinping_Thought_on_Socialism_with_Chinese_Characteristics_for_a_New_Era` | ~100 |

**Hugging Face ä»“åº“**ï¼š
- QA æ•°æ®é›†ï¼š[HEHUA2005/rag-benchmark-qa-dataset](https://huggingface.co/datasets/HEHUA2005/rag-benchmark-qa-dataset)
- PDF æ–‡æ¡£ï¼š[HEHUA2005/rag-benchmark-pdf-data](https://huggingface.co/datasets/HEHUA2005/rag-benchmark-pdf-data)

---

## ğŸ¯ æ•°æ®ç”Ÿæˆæ–¹æ³•è®º

### LLM-Driven QA ç”Ÿæˆç­–ç•¥

æœ¬ Benchmark çš„æ ¸å¿ƒåˆ›æ–°åœ¨äºé‡‡ç”¨ **LLM é©±åŠ¨çš„è‡ªåŠ¨åŒ–é—®é¢˜ç”Ÿæˆ**æ–¹æ³•ï¼Œç¡®ä¿é—®é¢˜è´¨é‡å’Œè¯„æµ‹çš„é’ˆå¯¹æ€§ï¼š

#### 1. æ–‡æ¡£åˆ†å—ç­–ç•¥
- **æŒ‰é¡µåˆ‡åˆ†**ï¼šå°† PDF æ–‡æ¡£æŒ‰é¡µæ•°åˆ‡åˆ†ï¼Œä¿ç•™é¡µç ä¿¡æ¯
- **ä¸Šä¸‹æ–‡ä¿æŒ**ï¼šæ¯ä¸ªé—®é¢˜ç”Ÿæˆæ—¶åŒ…å«ç›¸é‚»é¡µçš„ä¸Šä¸‹æ–‡ï¼Œç¡®ä¿è¯­ä¹‰å®Œæ•´æ€§

#### 2. é—®é¢˜ç”Ÿæˆæµç¨‹
```
PDF æ–‡æ¡£ â†’ æŒ‰é¡µæå– â†’ LLM ç”Ÿæˆé—®é¢˜ â†’ æ ‡æ³¨é¡µç æ¥æº â†’ è´¨é‡ç­›é€‰ â†’ QA æ•°æ®é›†
```

#### 3. æ¥æºæ ‡æ³¨æœºåˆ¶
ç”±äº RAG ç³»ç»Ÿçš„æ ¸å¿ƒèƒ½åŠ›æ˜¯**æ–‡æœ¬æ£€ç´¢ä¸æ¥æºè¿½æº¯**ï¼Œæˆ‘ä»¬çš„æ•°æ®é›†è®¾è®¡é‡ç‚¹è€ƒå¯Ÿï¼š
- âœ… **é¡µç å‡†ç¡®æ€§**ï¼šç­”æ¡ˆå¿…é¡»æ ‡æ³¨æ­£ç¡®çš„æ¥æºé¡µç 
- âœ… **æ–‡ä»¶æº¯æº**ï¼šç­”æ¡ˆéœ€å¼•ç”¨å…·ä½“çš„æ–‡æ¡£æ–‡ä»¶å
- âœ… **å¤šæ¥æºæ•´åˆ**ï¼šå¤æ‚é—®é¢˜å¯èƒ½éœ€è¦æ•´åˆå¤šä¸ªé¡µé¢çš„ä¿¡æ¯

#### 4. è¯„åˆ†æƒé‡è®¾è®¡
```python
Final Score = Source Accuracy Ã— 0.6    # æ¥æºå‡†ç¡®æ€§ï¼ˆæœ€é‡è¦ï¼‰
            + Content Accuracy Ã— 0.2   # å†…å®¹å‡†ç¡®æ€§
            + Completeness Ã— 0.15      # å®Œæ•´æ€§
            + Relevance Ã— 0.05         # ç›¸å…³æ€§
```

**è®¾è®¡ç†å¿µ**ï¼šæ¥æºå‡†ç¡®æ€§å  60% æƒé‡ï¼Œå¼ºè°ƒ RAG ç³»ç»Ÿçš„æ£€ç´¢èƒ½åŠ›æ˜¯æ ¸å¿ƒç«äº‰åŠ›ã€‚

> **æ³¨æ„**ï¼šQA æ•°æ®ç”Ÿæˆä»£ç æœªå¼€æ”¾ï¼Œå› å…¶æ¶‰åŠå¤§ä½œä¸šæ ¸å¿ƒå®ç°ã€‚ä½†ç”Ÿæˆçš„æ•°æ®é›†å·²åœ¨ Hugging Face ä¸Šå…¬å¼€ï¼Œå¯ç›´æ¥ä½¿ç”¨ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.8+
- OpenAI API Keyï¼ˆæˆ–å…¼å®¹ APIï¼‰
- è‡³å°‘ 2GB ç£ç›˜ç©ºé—´

### å®‰è£…æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**

```bash
git clone <repository-url>
cd SJTU-NLP-project2-benchmark
```

2. **å®‰è£…ä¾èµ–**

```bash
cd benchmark_pipline
pip install -r requirements.txt
```

3. **ä¸‹è½½æ•°æ®é›†**

```bash
# ä¸‹è½½æ‰€æœ‰æ•°æ®ï¼ˆPDF + QA æ•°æ®é›†ï¼‰
python download_data.py

# æˆ–åªä¸‹è½½ QA æ•°æ®é›†
python download_data.py --download qa

# æˆ–åªä¸‹è½½ PDF æ–‡æ¡£
python download_data.py --download pdf
```

4. **é…ç½® API**

```bash
cp config.yaml.example config.yaml
# ç¼–è¾‘ config.yamlï¼Œå¡«å†™ä½ çš„ API é…ç½®
```

**config.yaml å…³é”®é…ç½®**ï¼š

```yaml
api:
  api_key: "your-api-key-here"
  base_url: "https://api.openai.com/v1"
  model_id: "gpt-4"

benchmark:
  splits: "all"  # æˆ–æŒ‡å®šå•ä¸ªè¯¾ç¨‹ï¼Œå¦‚ "Mao_Zedong_Thought"
  max_questions_per_split: null  # null è¡¨ç¤ºè¿è¡Œæ‰€æœ‰é—®é¢˜
  enable_visualization: true

judge_evaluation:
  workers: 4  # å¹¶è¡Œ worker æ•°é‡
```

5. **å¿«é€Ÿæµ‹è¯•**

```bash
# æ¯ä¸ªæ•°æ®é›†æµ‹è¯• 1 ä¸ªé—®é¢˜ï¼ŒéªŒè¯ç¯å¢ƒé…ç½®
python test_pipeline.py --config config.yaml
```

6. **è¿è¡Œå®Œæ•´è¯„æµ‹**

```bash
python run_benchmark.py --config config.yaml
```

---

## ğŸ“Š è¯„æµ‹æµç¨‹è¯¦è§£

### Pipeline æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: æ•°æ®å‡†å¤‡                                            â”‚
â”‚  download_data.py                                           â”‚
â”‚  â”œâ”€â”€ ä» Hugging Face ä¸‹è½½ PDF æ–‡æ¡£ â†’ ../data/              â”‚
â”‚  â””â”€â”€ ä» Hugging Face ä¸‹è½½ QA æ•°æ®é›† â†’ ./QA_data/          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: å¿«é€Ÿæµ‹è¯•ï¼ˆå¯é€‰ï¼‰                                    â”‚
â”‚  test_pipeline.py                                           â”‚
â”‚  â””â”€â”€ æ¯ä¸ªæ•°æ®é›†æµ‹è¯• 1 ä¸ªé—®é¢˜ï¼ŒéªŒè¯é…ç½®                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3: å®Œæ•´è¯„æµ‹                                            â”‚
â”‚  run_benchmark.py                                           â”‚
â”‚  â”œâ”€â”€ æ£€æŸ¥ QA æ•°æ®é›†å®Œæ•´æ€§                                    â”‚
â”‚  â”œâ”€â”€ åˆå§‹åŒ– RAG Agentï¼ˆéœ€å®ç°ï¼‰                             â”‚
â”‚  â”œâ”€â”€ Step 4: ç”Ÿæˆ RAG å›ç­”ï¼ˆstep4_rag_answer.pyï¼‰          â”‚
â”‚  â”‚   â””â”€â”€ å¹¶è¡Œè°ƒç”¨ RAG Agent ç”Ÿæˆç­”æ¡ˆ                        â”‚
â”‚  â”œâ”€â”€ Step 5: LLM è¯„åˆ†ï¼ˆstep5_judge_evaluation.pyï¼‰         â”‚
â”‚  â”‚   â””â”€â”€ åŸºäºè¯„åˆ†æ ‡å‡†è‡ªåŠ¨æ‰“åˆ†                               â”‚
â”‚  â”œâ”€â”€ ä¿å­˜ç»“æœ â†’ evaluation_results/{timestamp}/            â”‚
â”‚  â””â”€â”€ ç”Ÿæˆå¯è§†åŒ– â†’ evaluation_results/{timestamp}/          â”‚
â”‚                    visualizations/{split}/                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¯„åˆ†ç»´åº¦è¯´æ˜

#### 1. Source Accuracyï¼ˆæ¥æºå‡†ç¡®æ€§ï¼‰- 60%
- æ£€æŸ¥ç­”æ¡ˆæ˜¯å¦æ­£ç¡®å¼•ç”¨é¡µç 
- éªŒè¯æ–‡ä»¶åæ˜¯å¦å‡†ç¡®
- è¯„ä¼°æ¥æºæ ‡æ³¨çš„å®Œæ•´æ€§

#### 2. Content Accuracyï¼ˆå†…å®¹å‡†ç¡®æ€§ï¼‰- 20%
- ç­”æ¡ˆå†…å®¹æ˜¯å¦ç¬¦åˆè¯¾ç¨‹æ–‡æ¡£
- æ˜¯å¦å­˜åœ¨äº‹å®æ€§é”™è¯¯
- ä¸“ä¸šæœ¯è¯­ä½¿ç”¨æ˜¯å¦å‡†ç¡®

#### 3. Completenessï¼ˆå®Œæ•´æ€§ï¼‰- 15%
- ç­”æ¡ˆæ˜¯å¦å…¨é¢è¦†ç›–é—®é¢˜è¦ç‚¹
- æ˜¯å¦é—æ¼å…³é”®ä¿¡æ¯
- è®ºè¿°æ˜¯å¦å……åˆ†

#### 4. Relevanceï¼ˆç›¸å…³æ€§ï¼‰- 5%
- ç­”æ¡ˆæ˜¯å¦åˆ‡é¢˜
- æ˜¯å¦åŒ…å«æ— å…³å†…å®¹

**é€šè¿‡æ ‡å‡†**ï¼šFinal Score â‰¥ 6.0

---

## ğŸ“ˆ å¯è§†åŒ–ç»“æœ

æ¯ä¸ªæ•°æ®é›†è‡ªåŠ¨ç”Ÿæˆ 6 ç§å¯è§†åŒ–å›¾è¡¨ï¼š

1. **å¹³å‡åˆ†æŸ±çŠ¶å›¾**ï¼šå„ç»´åº¦å¹³å‡å¾—åˆ†å¯¹æ¯”
2. **åˆ†æ•°åˆ†å¸ƒç®±çº¿å›¾**ï¼šå±•ç¤ºåˆ†æ•°åˆ†å¸ƒå’Œç¦»ç¾¤å€¼
3. **é›·è¾¾å›¾**ï¼šå¤šç»´åº¦èƒ½åŠ›åˆ†æ
4. **æœ€ç»ˆå¾—åˆ†åˆ†å¸ƒç›´æ–¹å›¾**ï¼šæ•´ä½“å¾—åˆ†åˆ†å¸ƒæƒ…å†µ
5. **æ‰€æœ‰é—®é¢˜å¯¹æ¯”å›¾**ï¼ˆâ‰¤100 é¢˜æ—¶ï¼‰ï¼šæ¯ä¸ªé—®é¢˜çš„è¯¦ç»†å¾—åˆ†
6. **æƒé‡è´¡çŒ®åˆ†æå›¾**ï¼šå„ç»´åº¦å¯¹æœ€ç»ˆå¾—åˆ†çš„è´¡çŒ®

### ç»“æœç›®å½•ç»“æ„

```
evaluation_results/
â””â”€â”€ 20251201_143025/              # æ—¶é—´æˆ³æ–‡ä»¶å¤¹
    â”œâ”€â”€ Mao_Zedong_Thought.csv   # è¯¦ç»†è¯„åˆ†ç»“æœ
    â”œâ”€â”€ Principles_of_Marxism.csv
    â”œâ”€â”€ ...
    â””â”€â”€ visualizations/           # å¯è§†åŒ–å›¾è¡¨
        â”œâ”€â”€ Mao_Zedong_Thought/
        â”‚   â”œâ”€â”€ Mao_Zedong_Thought_average_scores.png
        â”‚   â”œâ”€â”€ Mao_Zedong_Thought_score_distribution.png
        â”‚   â”œâ”€â”€ Mao_Zedong_Thought_radar_chart.png
        â”‚   â”œâ”€â”€ Mao_Zedong_Thought_final_score_histogram.png
        â”‚   â”œâ”€â”€ Mao_Zedong_Thought_all_questions.png
        â”‚   â””â”€â”€ Mao_Zedong_Thought_weighted_contribution.png
        â””â”€â”€ Principles_of_Marxism/
            â””â”€â”€ ...
```

---

## ğŸ› ï¸ é…ç½®ä¸å®šåˆ¶

### åªæµ‹è¯•ç‰¹å®šè¯¾ç¨‹

ç¼–è¾‘ [config.yaml](benchmark_pipline/config.yaml)ï¼š

```yaml
benchmark:
  splits: "Mao_Zedong_Thought"  # æŒ‡å®šå•ä¸ªè¯¾ç¨‹
```

### é™åˆ¶æµ‹è¯•é—®é¢˜æ•°é‡

```yaml
benchmark:
  max_questions_per_split: 50  # æ¯ä¸ªè¯¾ç¨‹æœ€å¤šæµ‹è¯• 50 ä¸ªé—®é¢˜
```

### è°ƒæ•´å¹¶è¡Œå¤„ç†æ•°é‡

```yaml
judge_evaluation:
  workers: 8  # å¢åŠ åˆ° 8 ä¸ªå¹¶è¡Œ worker
```

### ç¦ç”¨å¯è§†åŒ–

```yaml
benchmark:
  enable_visualization: false
```

---

## ğŸ“ å¦‚ä½•é›†æˆä½ çš„ RAG ç³»ç»Ÿ

### å‰ç½®æ¡ä»¶

æœ¬ Benchmark éœ€è¦ä½ å·²å®Œæˆ RAG ç³»ç»Ÿçš„æ ¸å¿ƒå®ç°ï¼ˆå¤§ä½œä¸šè¦æ±‚ï¼‰ï¼š

1. **æ–‡æ¡£å¤„ç†æ¨¡å—**ï¼ˆ[document_loader.py](document_loader.py)ï¼‰
   - `load_pdf()` - PDF æ–‡æœ¬æå–
   - `load_pptx()` - PPT æ–‡æœ¬æå–
   - `load_docx()` - Word æ–‡æ¡£æå–
   - `load_txt()` - çº¯æ–‡æœ¬è¯»å–

2. **æ–‡æœ¬åˆ‡åˆ†æ¨¡å—**ï¼ˆ[text_splitter.py](text_splitter.py)ï¼‰
   - `split_text()` - æ™ºèƒ½æ–‡æœ¬åˆ‡åˆ†

3. **å‘é‡æ•°æ®åº“æ¨¡å—**ï¼ˆ[vector_store.py](vector_store.py)ï¼‰
   - `get_embedding()` - è·å–æ–‡æœ¬å‘é‡
   - `add_documents()` - æ–‡æ¡£å…¥åº“
   - `search()` - å‘é‡æ£€ç´¢

4. **RAG Agent**ï¼ˆ[rag_agent.py](rag_agent.py)ï¼‰
   - `retrieve_context()` - æ£€ç´¢ç›¸å…³ä¸Šä¸‹æ–‡
   - `generate_response()` - ç”Ÿæˆå›ç­”

### é›†æˆæ­¥éª¤

1. ç¡®ä¿ä½ çš„ RAG Agent åœ¨é¡¹ç›®æ ¹ç›®å½•çš„ [rag_agent.py](rag_agent.py) ä¸­å®ç°
2. ç¡®ä¿ RAG Agent èƒ½å¤Ÿå¤„ç† `../data/` ç›®å½•ä¸‹çš„ PDF æ–‡æ¡£
3. è¿è¡Œ Benchmark è¯„æµ‹å³å¯

**RAG Agent æ¥å£è¦æ±‚**ï¼š

```python
class RAGAgent:
    def __init__(self):
        """åˆå§‹åŒ– RAG Agentï¼ŒåŠ è½½æ–‡æ¡£å¹¶å»ºç«‹å‘é‡åº“"""
        pass

    def query(self, question: str) -> str:
        """
        å¤„ç†é—®é¢˜å¹¶è¿”å›ç­”æ¡ˆ

        Args:
            question: ç”¨æˆ·é—®é¢˜

        Returns:
            ç­”æ¡ˆå­—ç¬¦ä¸²ï¼Œéœ€åŒ…å«æ¥æºä¿¡æ¯ï¼ˆæ–‡ä»¶åå’Œé¡µç ï¼‰
        """
        pass
```

---

## ğŸ“Š API èµ„æºè¯´æ˜

### é˜¿é‡Œäº‘ç™¾ç‚¼ï¼ˆæ¨èï¼‰

æ–°ç”¨æˆ·å¯è·å¾— **90 å¤© 100 ä¸‡ token** å…è´¹é¢åº¦ï¼Œæ”¯æŒï¼š
- Qwen-Max
- Qwen-Plus
- DeepSeek-V3
- å¤šç§ Embedding æ¨¡å‹

ç”³è¯·é“¾æ¥ï¼šhttps://help.aliyun.com/zh/model-studio/get-api-key

### å…¶ä»–å…¼å®¹ API

æœ¬é¡¹ç›®æ”¯æŒä»»ä½• OpenAI å…¼å®¹çš„ API æ¥å£ï¼š
- OpenAI å®˜æ–¹ API
- Azure OpenAI
- æœ¬åœ°éƒ¨ç½²çš„ LLMï¼ˆå¦‚ Ollamaã€vLLMï¼‰

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: è¿è¡Œ benchmark æ—¶æç¤ºæ•°æ®é›†ä¸å­˜åœ¨ï¼Ÿ

```bash
cd benchmark_pipline
python download_data.py --download qa
```

### Q2: å¦‚ä½•åªæµ‹è¯•ä¸€é—¨è¯¾ç¨‹ï¼Ÿ

ç¼–è¾‘ `config.yaml`ï¼š
```yaml
benchmark:
  splits: "Mao_Zedong_Thought"
```

### Q3: è¯„æµ‹é€Ÿåº¦å¤ªæ…¢æ€ä¹ˆåŠï¼Ÿ

å¢åŠ å¹¶è¡Œ worker æ•°é‡ï¼š
```yaml
judge_evaluation:
  workers: 8  # æ ¹æ®ä½ çš„ CPU æ ¸å¿ƒæ•°è°ƒæ•´
```

### Q4: å¦‚ä½•ç†è§£è¯„åˆ†ç»“æœï¼Ÿ

- **Final Score â‰¥ 6.0**ï¼šé€šè¿‡ï¼Œç³»ç»Ÿè¡¨ç°è‰¯å¥½
- **Source Accuracy ä½**ï¼šæ£€ç´¢èƒ½åŠ›ä¸è¶³ï¼Œéœ€ä¼˜åŒ–å‘é‡æ£€ç´¢æˆ–æ–‡æœ¬åˆ‡åˆ†
- **Content Accuracy ä½**ï¼šç”Ÿæˆèƒ½åŠ›ä¸è¶³ï¼Œéœ€ä¼˜åŒ– Prompt æˆ–æ›´æ¢æ›´å¼ºçš„ LLM
- **Completeness ä½**ï¼šæ£€ç´¢çš„ä¸Šä¸‹æ–‡ä¸å¤Ÿå……åˆ†ï¼Œéœ€å¢åŠ  `TOP_K` å‚æ•°

### Q5: å¯ä»¥è‡ªå®šä¹‰è¯„åˆ†æƒé‡å—ï¼Ÿ

å¯ä»¥ä¿®æ”¹ [step5_judge_evaluation.py](benchmark_pipline/step5_judge_evaluation.py) ä¸­çš„è¯„åˆ†é€»è¾‘ï¼š

```python
final_score = (
    source_accuracy * 0.6 +
    content_accuracy * 0.2 +
    completeness * 0.15 +
    relevance * 0.05
)
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
SJTU-NLP-project2-benchmark/
â”œâ”€â”€ benchmark_pipline/        # Benchmark è¯„æµ‹æ¡†æ¶ï¼ˆæœ¬é¡¹ç›®æ ¸å¿ƒï¼‰
â”‚   â”œâ”€â”€ config.yaml.example   # é…ç½®æ–‡ä»¶æ¨¡æ¿
â”‚   â”œâ”€â”€ download_data.py      # æ•°æ®ä¸‹è½½è„šæœ¬
â”‚   â”œâ”€â”€ download_pdf_data.py  # PDF æ•°æ®ä¸‹è½½
â”‚   â”œâ”€â”€ test_pipeline.py      # å¿«é€Ÿæµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ run_benchmark.py      # å®Œæ•´è¯„æµ‹è„šæœ¬
â”‚   â”œâ”€â”€ step4_rag_answer.py   # RAG å›ç­”ç”Ÿæˆ
â”‚   â”œâ”€â”€ step5_judge_evaluation.py  # LLM è¯„åˆ†
â”‚   â”œâ”€â”€ visualize.py          # å¯è§†åŒ–ç”Ÿæˆ
â”‚   â”œâ”€â”€ upload_pdf_data.py    # æ•°æ®ä¸Šä¼ ï¼ˆç»´æŠ¤è€…ä½¿ç”¨ï¼‰
â”‚   â”œâ”€â”€ QA_data/              # QA æ•°æ®é›†ï¼ˆä¸‹è½½åç”Ÿæˆï¼‰
â”‚   â”œâ”€â”€ evaluation_results/   # è¯„æµ‹ç»“æœï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚   â””â”€â”€ README.md             # Benchmark è¯¦ç»†æ–‡æ¡£
â”‚
â”œâ”€â”€ data/                     # PDF è¯¾ç¨‹æ–‡æ¡£ï¼ˆä¸‹è½½åç”Ÿæˆï¼‰
â”œâ”€â”€ vector_db/                # å‘é‡æ•°æ®åº“ï¼ˆRAG ç³»ç»Ÿç”Ÿæˆï¼‰
â”‚
â”œâ”€â”€ config.py                 # RAG ç³»ç»Ÿé…ç½®
â”œâ”€â”€ document_loader.py        # æ–‡æ¡£åŠ è½½æ¨¡å—ï¼ˆéœ€å®ç°ï¼‰
â”œâ”€â”€ text_splitter.py          # æ–‡æœ¬åˆ‡åˆ†æ¨¡å—ï¼ˆéœ€å®ç°ï¼‰
â”œâ”€â”€ vector_store.py           # å‘é‡æ•°æ®åº“æ¨¡å—ï¼ˆéœ€å®ç°ï¼‰
â”œâ”€â”€ rag_agent.py             # RAG Agentï¼ˆéœ€å®ç°ï¼‰
â”œâ”€â”€ process_data.py          # æ•°æ®å¤„ç†æµæ°´çº¿
â”œâ”€â”€ main.py                  # äº¤äº’å¼ä¸»ç¨‹åº
â”œâ”€â”€ requirements.txt         # é¡¹ç›®ä¾èµ–
â””â”€â”€ README.md                # æœ¬æ–‡ä»¶
```

---

## ğŸŒŸ æ‰©å±•æ–¹å‘

### æŠ€æœ¯ä¼˜åŒ–

- **æ··åˆæ£€ç´¢**ï¼šç»“åˆ BM25ï¼ˆç¨€ç–æ£€ç´¢ï¼‰å’Œå‘é‡æ£€ç´¢ï¼ˆå¯†é›†æ£€ç´¢ï¼‰
- **é‡æ’åº**ï¼šä½¿ç”¨ Reranker æ¨¡å‹æå‡æ£€ç´¢ç²¾åº¦
- **æŸ¥è¯¢æ”¹å†™**ï¼šä¼˜åŒ–ç”¨æˆ·é—®é¢˜ä»¥æé«˜æ£€ç´¢æ•ˆæœ
- **å¤šæ¨¡æ€æ”¯æŒ**ï¼šå¤„ç†è¯¾ä»¶ä¸­çš„å›¾ç‰‡ã€å›¾è¡¨ç­‰éæ–‡æœ¬å†…å®¹

### è¯„æµ‹ä¼˜åŒ–

- **æ›´å¤šç»´åº¦**ï¼šå¢åŠ é€»è¾‘è¿è´¯æ€§ã€è¯­è¨€æµç•…åº¦ç­‰è¯„åˆ†ç»´åº¦
- **äººå·¥æ ‡æ³¨**ï¼šç»“åˆäººå·¥è¯„æµ‹è¿›è¡Œ Benchmark æ ¡å‡†
- **å¯¹æŠ—æ ·æœ¬**ï¼šç”Ÿæˆæ›´å…·æŒ‘æˆ˜æ€§çš„æµ‹è¯•é—®é¢˜

---

## ğŸ“ ä½œä¸šæäº¤

æäº¤å†…å®¹åº”åŒ…æ‹¬ï¼š

1. **å®Œæ•´çš„ RAG ç³»ç»Ÿå®ç°**
2. **Benchmark è¯„æµ‹ç»“æœ**
   - CSV ç»“æœæ–‡ä»¶
   - å¯è§†åŒ–å›¾è¡¨
   - ç»Ÿè®¡åˆ†ææŠ¥å‘Š
3. **å®éªŒæŠ¥å‘Š**
   - è®¾è®¡æ€è·¯
   - å®ç°ç»†èŠ‚
   - Benchmark ç»“æœåˆ†æ
   - æ”¹è¿›æ–¹å‘
4. **æ‰©å±•åŠŸèƒ½è¯´æ˜**ï¼ˆå¦‚æœ‰ï¼‰

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [RAG æŠ€æœ¯ç»¼è¿°](https://arxiv.org/abs/2312.10997)
- [Hugging Face Datasets æ–‡æ¡£](https://huggingface.co/docs/datasets)
- [ChromaDB æ–‡æ¡£](https://docs.trychroma.com/)
- [OpenAI API æ–‡æ¡£](https://platform.openai.com/docs)
- [LangChain RAG æ•™ç¨‹](https://python.langchain.com/docs/use_cases/question_answering/)

---

## ğŸ‘¥ è´¡çŒ®è€…

- é¡¹ç›®ä½œè€…ï¼šHEHUA
- è¯¾ç¨‹ï¼šä¸Šæµ·äº¤é€šå¤§å­¦ CS3602 è‡ªç„¶è¯­è¨€å¤„ç†
- å­¦æœŸï¼š2024-2025-1

---

## ğŸ“„ License

æœ¬é¡¹ç›®é‡‡ç”¨ MIT åè®®å¼€æºï¼Œè¯¦è§ LICENSE æ–‡ä»¶ã€‚

---

<div align="center">

**Happy Benchmarking!** ğŸ‰

å¦‚æœ‰é—®é¢˜ï¼Œæ¬¢è¿æäº¤ Issue æˆ– PR

[Hugging Face Dataset](https://huggingface.co/datasets/HEHUA2005/rag-benchmark-qa-dataset) | [é¡¹ç›®æ–‡æ¡£](benchmark_pipline/README.md)

</div>
